language: php
php:  
  - "5.4" 
before_install:
- sudo add-apt-repository --yes ppa:beineri/opt-qt53
- sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
- sudo apt-get update -qq
- sudo apt-get install qt53base qt53imageformats qt53tools qt53xmlpatterns -y -qq
- export QTDIR=/opt/qt53
- export PATH=$QTDIR/bin:$PATH
- export LD_LIBRARY_PATH=$QTDIR/lib/:$QTDIR/lib/`uname -m`-linux-gnu:$LD_LIBRARY_PATH
- sudo apt-get install gcc-4.7 g++-4.7 -y -qq
- sudo rm -f /usr/bin/gcc
- sudo rm -f /usr/bin/g++
- sudo ln -s /usr/bin/gcc-4.7 /usr/bin/gcc
- sudo ln -s /usr/bin/g++-4.7 /usr/bin/g++
script:
  - qmake -v
  - qmake DESTDIR=./bin/
  - make
  - cd ./tests/webserver_stub/
  - chmod +x ./run.sh 
  - ./run.sh &
  - sleep 10
  - curl http://127.0.0.1:8080/
  - cd ./../tests/
  - qmake
  - make -s
  - cd ./../bin/
  - ./tests -platform minimal -txt